<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .file-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .file-item {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        /* Couleurs spécifiques pour chaque profession */
        .elm .file-item { background-color: #f0f8ff; } /* AliceBlue */
        .iel .file-item { background-color: #e6e6fa; } /* Lavender */
        .pele .file-item { background-color: #fff0f5; } /* LavenderBlush */
        .tlm .file-item { background-color: #f5fffa; } /* MintCream */        
        .file-name {
            font-size: 14px;
            margin-bottom: 5px;
        }
        .title-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .disclaimer {
            color: red;
            font-size: 0.8em;
            margin: 0;
        }
        h1 {
            margin-bottom: 20px;
        }
        .success-button {
            padding: 10px 15px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 5px; /* Add some space between title and button */
            text-align: left; /* Ensure text inside the button is left-aligned */
            background-color: #e72696; color: #ffffff;
        }
        .success-button.retour { background-color: #FF9800; color: white; }
        .file-links {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="section-header">
        <h1>Fichiers ORAUX QCM CFC (2025.03.15)</h1>
        <button class="success-button" onclick="window.open('https://cfctselec.github.io/cfcflashcards/', '_blank');">D'autres façons de réviser votre CFC</button>
        <button class="success-button retour" onclick="window.location.href='https://qrhd1.github.io/oldcfc/';">Retour</button>
    </div>    
    
    <div class="file-grid" id="qcm-files"></div>

    <script>
        async function fetchFiles() {
            const apiUrl = 'https://api.github.com/repos/qrhd1/oldcfc/contents/qcm_files';
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`Erreur de l'API GitHub: ${response.status}`);
                }
                const files = await response.json();
                return files.filter(file => file.name.endsWith('.html') && file.name.startsWith('qcm_'));
            } catch (error) {
                console.error("Erreur lors de la récupération des fichiers:", error);
                
                // Simuler une liste de fichiers si l'API échoue
                // Cette liste est basée sur le format observé dans le code
                const simulatedFiles = [];
                
                // Générer des fichiers pour les chapitres 1-10 et les 4 professions
                const professions = ['elm', 'iel', 'pele', 'tlm'];
                for (let chapter = 1; chapter <= 10; chapter++) {
                    for (const profession of professions) {
                        simulatedFiles.push({
                            name: `qcm_chapitre_${chapter}_${profession}.html`,
                            path: `qcm_files/qcm_chapitre_${chapter}_${profession}.html`
                        });
                    }
                }
                
                return simulatedFiles;
            }
        }
        
        function extractChapterNumber(filename) {
            // Extraire le numéro de chapitre du nom de fichier (ex: qcm_chapitre_1_iel.html -> 1)
            const match = filename.match(/qcm_chapitre_(\d+)_/);
            return match ? parseInt(match[1]) : 0;
        }

        function extractProfessionType(filename) {
            // Extraire le type de profession (elm, iel, pele, tlm)
            if (filename.includes('_elm')) return 'elm';
            if (filename.includes('_iel')) return 'iel';
            if (filename.includes('_pele')) return 'pele';
            if (filename.includes('_tlm')) return 'tlm';
            return '';
        }

        function createFileElement(file) {
            const container = document.createElement('div');
            const professionType = extractProfessionType(file.name);
            container.className = `file-item ${professionType}`;

            // Simplifier l'affichage du nom du fichier
            let displayName = file.name;
            if (file.name.startsWith('qcm_chapitre_')) {
                const chapterNum = extractChapterNumber(file.name);
                const profession = extractProfessionType(file.name).toUpperCase();
                displayName = `Chapitre ${chapterNum} - ${profession}`;
            }
            
            // Ajouter le titre
            const title = document.createElement('div');
            title.className = 'file-name';
            title.textContent = displayName;
            container.appendChild(title);
            
            // Ajouter les liens (deux options)
            const linksContainer = document.createElement('div');
            linksContainer.className = 'file-links';
            
            // Option 1: Lien GitHub Pages
            const linkGithubPages = document.createElement('a');
            linkGithubPages.href = `https://qrhd1.github.io/oldcfc/qcm_files/${file.name}`;
            linkGithubPages.target = '_blank';
            linkGithubPages.textContent = 'Ouvrir';
            linkGithubPages.className = 'success-button';
            linksContainer.appendChild(linkGithubPages);
            
            // Option 2: Lien HTML Preview (alternative)
            const linkHtmlPreview = document.createElement('a');
            linkHtmlPreview.href = `https://htmlpreview.github.io/?https://github.com/qrhd1/oldcfc/blob/main/qcm_files/${file.name}`;
            linkHtmlPreview.target = '_blank';
            linkHtmlPreview.textContent = 'Alternative';
            linkHtmlPreview.className = 'success-button retour';
            linkHtmlPreview.style.fontSize = '12px';
            linksContainer.appendChild(linkHtmlPreview);
            
            container.appendChild(linksContainer);

            return container;
        }

        function displayFiles(files) {
            const container = document.getElementById('qcm-files');
            
            // Trier les fichiers par numéro de chapitre
            const sortedFiles = [...files].sort((a, b) => {
                const numA = extractChapterNumber(a.name);
                const numB = extractChapterNumber(b.name);
                if (numA === numB) {
                    return a.name.localeCompare(b.name);
                }
                return numA - numB;
            });

            // Créer et ajouter les éléments pour chaque fichier
            sortedFiles.forEach(file => {
                const fileElement = createFileElement(file);
                container.appendChild(fileElement);
            });
        }

        async function main() {
            try {
                const files = await fetchFiles();
                displayFiles(files);
            } catch (error) {
                console.error("Erreur lors du chargement des fichiers:", error);
                const container = document.getElementById('qcm-files');
                container.innerHTML = '<p>Erreur lors du chargement des fichiers. Veuillez réessayer plus tard.</p>';
            }
        }

        main();
    </script>
</body>
</html>